# GitHub Actions CI/CD é…ç½®

æœ¬é¡¹ç›®ä½¿ç”¨ GitHub Actions è¿›è¡ŒæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªå·¥ä½œæµçš„è¯´æ˜ï¼š

## ğŸ”„ å·¥ä½œæµæ¦‚è§ˆ

### 1. CI Pipeline (`ci.yml`)
**è§¦å‘æ¡ä»¶**: æ¨é€åˆ° main åˆ†æ”¯ã€PR åˆ° main åˆ†æ”¯ã€æ‰‹åŠ¨è§¦å‘

åŒ…å«ä»¥ä¸‹æ£€æŸ¥ï¼š
- **æ ¼å¼æ£€æŸ¥** (`fmt`): ä½¿ç”¨ `cargo fmt` æ£€æŸ¥ä»£ç æ ¼å¼
- **ä»£ç è´¨é‡** (`clippy`): ä½¿ç”¨ `cargo clippy` è¿›è¡Œé™æ€åˆ†æ
- **æµ‹è¯•å¥—ä»¶** (`test`): åœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿå’Œ Rust ç‰ˆæœ¬ä¸Šè¿è¡Œæµ‹è¯•
- **ä»£ç è¦†ç›–ç‡** (`coverage`): ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šå¹¶ä¸Šä¼ åˆ° Codecov
- **æ–‡æ¡£ç”Ÿæˆ** (`docs`): æ„å»º API æ–‡æ¡£å¹¶éƒ¨ç½²åˆ° GitHub Pages
- **å®‰å…¨å®¡è®¡** (`audit`): æ£€æŸ¥ä¾èµ–çš„å®‰å…¨æ¼æ´
- **åŸºå‡†æµ‹è¯•** (`bench`): è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆä»…åœ¨ main åˆ†æ”¯ï¼‰

### 2. Release Pipeline (`release.yml`)
**è§¦å‘æ¡ä»¶**: æ¨é€ç‰ˆæœ¬æ ‡ç­¾ (`v*.*.*`) æˆ–æ‰‹åŠ¨è§¦å‘

å‘å¸ƒæµç¨‹ï¼š
1. **é¢„æ£€æŸ¥**: è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶
2. **åˆ›å»º GitHub Release**: è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒè¯´æ˜
3. **å‘å¸ƒåˆ° crates.io**: è‡ªåŠ¨å‘å¸ƒåŒ…
4. **æ›´æ–°æ–‡æ¡£**: éƒ¨ç½²æœ€æ–°æ–‡æ¡£
5. **å‘å¸ƒé€šçŸ¥**: æ€»ç»“å‘å¸ƒçŠ¶æ€

### 3. Dependencies Management (`dependencies.yml`)
**è§¦å‘æ¡ä»¶**: æ¯å‘¨ä¸€è‡ªåŠ¨è¿è¡Œæˆ–æ‰‹åŠ¨è§¦å‘

ä¾èµ–ç®¡ç†ï¼š
- **æ£€æŸ¥è¿‡æ—¶ä¾èµ–**: ç”Ÿæˆä¾èµ–çŠ¶æ€æŠ¥å‘Š
- **è‡ªåŠ¨æ›´æ–°è¡¥ä¸ç‰ˆæœ¬**: åˆ›å»º PR æ›´æ–°å®‰å…¨è¡¥ä¸
- **å®‰å…¨å®¡è®¡**: æ£€æŸ¥å·²çŸ¥å®‰å…¨æ¼æ´
- **è®¸å¯è¯æ£€æŸ¥**: éªŒè¯ä¾èµ–è®¸å¯è¯å…¼å®¹æ€§

## ğŸ”§ è®¾ç½®è¯´æ˜

### å¿…éœ€çš„ Secrets

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ secretsï¼š

1. **CRATES_IO_TOKEN**: crates.io API token
   ```bash
   # è·å– token
   cargo login
   # åœ¨ ~/.cargo/credentials ä¸­æ‰¾åˆ° token
   ```

2. **CODECOV_TOKEN** (å¯é€‰): Codecov ä¸Šä¼  token
   - åœ¨ [codecov.io](https://codecov.io) æ³¨å†Œå¹¶è·å–é¡¹ç›® token

### GitHub Pages è®¾ç½®

1. è¿›å…¥ä»“åº“ Settings â†’ Pages
2. Source é€‰æ‹© "GitHub Actions"
3. æ–‡æ¡£å°†è‡ªåŠ¨éƒ¨ç½²åˆ° `https://yourusername.github.io/supabase-jwt/docs/`

### åˆ†æ”¯ä¿æŠ¤è§„åˆ™

å»ºè®®ä¸º `main` åˆ†æ”¯è®¾ç½®ä¿æŠ¤è§„åˆ™ï¼š

1. è¿›å…¥ Settings â†’ Branches
2. æ·»åŠ è§„åˆ™ä¿æŠ¤ `main` åˆ†æ”¯
3. å¯ç”¨ä»¥ä¸‹é€‰é¡¹ï¼š
   - Require a pull request before merging
   - Require status checks to pass before merging
   - Require branches to be up to date before merging
   - Restrict pushes that create files
   - é€‰æ‹©å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥ï¼š
     - `Format Check`
     - `Clippy Check`
     - `Test Suite (ubuntu-latest, stable)`

## ğŸ“‹ å‘å¸ƒæµç¨‹

### è‡ªåŠ¨å‘å¸ƒ

1. æ›´æ–° `Cargo.toml` ä¸­çš„ç‰ˆæœ¬å·
2. æ›´æ–° `CHANGELOG.md`
3. æäº¤æ›´æ”¹åˆ° main åˆ†æ”¯
4. åˆ›å»ºå¹¶æ¨é€ç‰ˆæœ¬æ ‡ç­¾ï¼š
   ```bash
   git tag v0.1.2
   git push origin v0.1.2
   ```
5. GitHub Actions å°†è‡ªåŠ¨å¤„ç†å‘å¸ƒæµç¨‹

### æ‰‹åŠ¨å‘å¸ƒ

1. è¿›å…¥ Actions é¡µé¢
2. é€‰æ‹© "Release" å·¥ä½œæµ
3. ç‚¹å‡» "Run workflow"
4. è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¦‚ `v0.1.2`ï¼‰

## ğŸ“Š ç›‘æ§å’ŒæŠ¥å‘Š

### ä»£ç è¦†ç›–ç‡
- æŸ¥çœ‹ [Codecov æŠ¥å‘Š](https://codecov.io/gh/yourusername/supabase-jwt)
- æ¯æ¬¡ PR éƒ½ä¼šæ˜¾ç¤ºè¦†ç›–ç‡å˜åŒ–

### æ–‡æ¡£
- API æ–‡æ¡£: `https://yourusername.github.io/supabase-jwt/docs/`
- docs.rs: `https://docs.rs/supabase-jwt`

### ä¾èµ–æŠ¥å‘Š
- æ¯å‘¨è‡ªåŠ¨ç”Ÿæˆä¾èµ–çŠ¶æ€æŠ¥å‘Š
- å®‰å…¨æ¼æ´ä¼šè‡ªåŠ¨åˆ›å»º Issue
- è¡¥ä¸æ›´æ–°ä¼šè‡ªåŠ¨åˆ›å»º PR

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

åœ¨æäº¤å‰è¿è¡Œä»¥ä¸‹å‘½ä»¤ç¡®ä¿ CI é€šè¿‡ï¼š

```bash
# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# æ£€æŸ¥ä»£ç è´¨é‡
cargo clippy --all-targets --all-features -- -D warnings

# è¿è¡Œæµ‹è¯•
cargo test --all-features

# æ„å»ºæ–‡æ¡£
cargo doc --no-deps --all-features

# å®‰å…¨å®¡è®¡
cargo audit
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å‘å¸ƒå¤±è´¥**: æ£€æŸ¥ `CRATES_IO_TOKEN` æ˜¯å¦æ­£ç¡®è®¾ç½®
2. **æµ‹è¯•è¶…æ—¶**: å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´æˆ–ä¼˜åŒ–æµ‹è¯•æ€§èƒ½
3. **æ–‡æ¡£éƒ¨ç½²å¤±è´¥**: ç¡®ä¿ GitHub Pages å·²å¯ç”¨
4. **ä¾èµ–æ›´æ–°å¤±è´¥**: æ£€æŸ¥æ˜¯å¦æœ‰ç ´åæ€§å˜æ›´

### è°ƒè¯•æŠ€å·§

- ä½¿ç”¨ `workflow_dispatch` æ‰‹åŠ¨è§¦å‘å·¥ä½œæµè¿›è¡Œè°ƒè¯•
- æŸ¥çœ‹ Actions æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
- åœ¨æœ¬åœ°å¤ç° CI ç¯å¢ƒè¿›è¡Œæµ‹è¯•

## ğŸ“ è‡ªå®šä¹‰é…ç½®

æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œæ‚¨å¯ä»¥ï¼š

- è°ƒæ•´æµ‹è¯•çŸ©é˜µï¼ˆæ“ä½œç³»ç»Ÿã€Rust ç‰ˆæœ¬ï¼‰
- ä¿®æ”¹ä¾èµ–æ›´æ–°é¢‘ç‡
- æ·»åŠ é¢å¤–çš„æ£€æŸ¥æ­¥éª¤
- è‡ªå®šä¹‰å‘å¸ƒæµç¨‹

æ›´å¤šè¯¦ç»†é…ç½®è¯·å‚è€ƒå„ä¸ª `.yml` æ–‡ä»¶ä¸­çš„æ³¨é‡Šã€‚